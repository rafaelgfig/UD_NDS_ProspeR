Explorando e resumindo dados de empréstimos da Prosper por Rafael G. Figueira
========================================================
<p>Esse relatório explora um conjunto de dados de empréstimos da Prosper, possuindo 113.937 empréstimos com 81 variáveis em cada um, incluindo valor, taxa de juros, status do pagamento, receita do mutuário, seu emprego atual, histórico do cartão de crédito, informações sobre seu último pagamento, entre outras.</p>
```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Carregamento das bibliotécas
library(dplyr)
library(gridExtra)
library(ggplot2)
library(tidyr)
library(purrr)
```

```{r echo=FALSE, Load_the_Data}
# Carregamento dos dados
df <- read.csv('prosperLoanData.csv')
```

## Seção de Gráficos Univariados
<p>O conjunto de dados original possui 113937 linhas e 81 colunas.</p>
```{r echo=FALSE, Univariate_Plots}
# Dimensão dos dados originais
dim(df)
```
<p>Foram escolhidas 15 variáveis julgadas mais interessantes para a minha análise.<br/> Sendo elas:</p>
* MemberKey
* LoanKey
* Term
* LoanStatus
* BorrowerAPR
* BorrowerRate
* ProsperScore
* ListingCategory..numeric.
* Occupation
* EmploymentStatus
* EmploymentStatusDuration
* StatedMonthlyIncome
* LoanOriginalAmount
* LoanOriginationDate
* MonthlyLoanPayment

Abaixo seguem algumas informações úteis sobre os dados.<br/>
```{r echo=FALSE}
# Selecionando algumas colunas de interesse
dff <- (subset(df, select = c('MemberKey',
                              'LoanKey',
                              'Term',
                              'LoanStatus',
                              'BorrowerAPR',
                              'BorrowerRate',
                              'ProsperScore',
                              'ListingCategory..numeric.',
                              'Occupation',
                              'EmploymentStatus',
                              'EmploymentStatusDuration',
                              'StatedMonthlyIncome',
                              'LoanOriginalAmount',
                              'LoanOriginationDate',
                              'MonthlyLoanPayment')
            )
     )
```


```{r echo=FALSE}
# Colunas e tipos de dados
str(dff)
```

```{r echo=FALSE}
# Resumo estatístico
summary(dff)
```
<br/>Quantidade de NA's:
```{r echo=FALSE}
# Verificando quantidade de NA's
colSums(is.na(dff))
```

Visualizando distribuição das variáveis selecionadas.<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=12}
# Histograma básico das colunas
dff %>%
  keep(is.numeric) %>%
  gather() %>%
  ggplot(aes(value)) +
    facet_wrap(~key, scales = 'free', ncol = 1) +
    geom_histogram()
```

<p>É possível ver que o histograma da variável <em>StatedMonthlyIncome</em> está totalmente concentrado em zero.</p>
Analizando o resumo estatístico é possível ver que a variável contém alguns dados discrepantes.
```{r echo=FALSE}
# Verificando que plotagem da renda mensal está enviesada por conta de outlier
summary(dff$StatedMonthlyIncome)
```

<p>Os 10 valores mais altos da variável são:</p>
```{r echo=FALSE}
# Visualizando as 10 maiores rendas declaradas
sort(tail(sort(dff$StatedMonthlyIncome), 10), decreasing = T)
```

<p>Visualizando os dados sem 0.5% dos maiores valores.</p>
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Plotagem removendo 0.5% das maiores rendas
ggplot(dff, aes(x = StatedMonthlyIncome)) +
  geom_histogram(binwidth = 250) +
  scale_x_continuous(limits = c(0, quantile(dff$StatedMonthlyIncome, .995)))
```

<p>Omitindo 5% dos maiores valores:</p>
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Plotagem removendo 5% das maiores rendas
ggplot(dff, aes(x = StatedMonthlyIncome)) +
  geom_histogram(binwidth = 250, color = 'black') +
  scale_x_continuous(limits = c(0, quantile(dff$StatedMonthlyIncome, .95)),
                     breaks = seq(0, 12500, 1000))
```

Nos gráficos abaixo podemos ver que a maioria dos empréstimo possuem valores arredondados, dando ênfase para empréstimos de 4.000, os posteriores tendem a ser múltiplos de 5.000.<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Distribuição dos dados da coluna LoanOriginalAmount
g <- ggplot(df, aes(x = LoanOriginalAmount)) +
  scale_x_continuous(breaks = seq(0, max(df$LoanOriginalAmount), 5000))
g1 <- g + geom_histogram(binwidth = 1000)
g2 <- g + geom_histogram(binwidth = 500)
g3 <- g + geom_histogram(binwidth = 250)
grid.arrange(g1, g2, g3, ncol = 1)
```

<p>Abaixo é possível observar que é mais comum encontrar pessoas com poucos meses de emprego solicitando empréstimo do que em comparação com aqueles com muito tempo.</p>
Tempo em meses:<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Distribuição do tempo de emprego omitindo 5%
ggplot(subset(dff, !is.na(EmploymentStatusDuration)), aes(x = EmploymentStatusDuration)) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(0, quantile(dff$EmploymentStatusDuration, .95, na.rm = T)),
                     breaks = seq(0, 300, 25))
```

Tempo em anos:<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Distribuição do tempo de emprego em anos omitindo 5%
ggplot(subset(dff, !is.na(EmploymentStatusDuration)), aes(x = floor(EmploymentStatusDuration/12))) +
  geom_histogram(binwidth = 1, color = 'black') +
  scale_x_continuous(limits = c(0, quantile(dff$EmploymentStatusDuration/12, .95, na.rm = T)),
                     breaks = seq(0, 25, 1))
```

Distribuição dos status do emprego:<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Distribuição dos status do emprego
ggplot(subset(dff, EmploymentStatus != ''), aes(x = reorder(EmploymentStatus, -table(EmploymentStatus)[EmploymentStatus]))) +
  geom_bar() +
  xlab('EmploymentStatus')
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Porcentagem de mutuários declaradamente sem emprego
round(sum(dff$EmploymentStatus == 'Not employed')/length(dff$EmploymentStatus),digits = 3)*100
```
A grande maioria dos solicitantes de empréstimos está atualmente empregado de alguma forma. Apenas 0.7% dos mutuários são declaradamente desempregados.

<br/>
O histograma da duração do empréstimo ficou muito espaçado por conta da coluna estar como tipo de valor inteiro, e como só há 3 variações de duração (12, 36 ou 60) dentro dessa coluna, é possível assumí-la como dado categórico e plotar como tal. <br/>
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=4, fig.width=2}
# Alterando variável para o tipo categórica, já que só há 3 tipos de valores
dff$Term <- factor(dff$Term)
# Distribuição da duração do empréstimo
ggplot(dff, aes(x = Term)) + 
  geom_bar()
```

<br/>
Categorias mais selecionadas pelo mutuário:<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
# Alterando variável ListingCategory..numeric. para categórica
dff$ListingCategory..numeric. <- factor(dff$ListingCategory..numeric.)
# Distribuição dos status do emprego
ggplot(dff, aes(x = reorder(ListingCategory..numeric., -table(ListingCategory..numeric.)[ListingCategory..numeric.]))) +
  geom_bar(width = .8) +
  scale_y_continuous(breaks = scales::trans_breaks('log10', function(x) 10^x),
                     labels = scales::trans_format('log10', scales::math_format(10^.x)),
                     trans = 'log10')+
  xlab('ListingCategory')
```
<br/> Legenda das categorias:

0. Não disponível
1. Consolidação da dívida
2. Melhoria da casa
3. Negócios
4. Empréstimo pessoal
5. Uso do aluno
6. Automático
7. Outros 
8. Bebê e Adoção
9. Barco
10. Procedimento Cosmético
11. Anel de Noivado
12. Empréstimos Verdes
13. Gastos Domésticos
14. Grandes Compras
15. Médico / Odontológico
16. Motocicleta
17. VD
18. Impostos
19. Férias
20. Empréstimos do casamento

<p/>
<br/>
Distribuição das ocupações declaradas:<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=20}
# Distribuição dos status do emprego
ggplot(dff, aes(x = reorder(Occupation, +table(Occupation)[Occupation]))) +
  geom_bar() +
  xlab('Occupation') +
#  scale_y_log10() +
  coord_flip()
```
<br/>A grande maioria declarou como "Outra" a ocupação ou declarou apenas como ocupação profissional, não sendo possível afirmar corretamente qual a ocupação mais comum. Das ocupações especificamente declaradas o programador de computador ficou em destaque.

<br/>
Distribuição dos valores das parcelas:<br/>
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=12}
# Distribuição das parcelas
g <- ggplot(dff, aes(x = MonthlyLoanPayment)) +
  scale_x_continuous(limits = c(0, quantile(dff$MonthlyLoanPayment, .99)),
                     breaks = seq(25, 1000, 50))
g1 <- g + geom_histogram(binwidth = 25, color='black')
g2 <- g + geom_histogram(binwidth = 10, color='black')
g3 <- g + geom_histogram(binwidth = 5)
g4 <- g + geom_histogram(binwidth = 1)

grid.arrange(g1, g2, g3, g4, ncol = 1)
```
<br/> Vemos uma frequência altíssima de mutuários com valor de parcela próximo da casa dos 175, mas pelo gráfico não é possível ter muita precisão, por mais que seja determinado 1 de binwidth.
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Valor com maior ocorrência no conjunto de dados
head(sort(table(dff$MonthlyLoanPayment),decreasing = T), 3)
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
round(sum(dff$MonthlyLoanPayment == 173.71) / length(dff$MonthlyLoanPayment) * 100, 2)
```
Verificado que 2423 parcelas de mutuários têm exatamente 173.71 como valor. Representando 2.13% de todos os dados.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Verificando os dados com parcela de 173.71
#names(dff)
subset(dff, MonthlyLoanPayment == 173.71) %>% 
  select(MemberKey, Term, LoanOriginalAmount, MonthlyLoanPayment, BorrowerAPR, ProsperScore) %>%
  summary()
```
Todos aqueles que solicitaram empréstimo de 4.000 para ser pago em 36 meses com APR de 0.358 tem o mesmo valor de parcela.<br/>
Foi verificado anteiormente que o valor mais solicitado é de 4.000 e a duração mais popular também é a de 36 meses, justificando a concentração anormal do valor da parcela com essa APR.

<br/>
Foi verificado também alguns empréstimos com pagamento mensal programado com valor zerado, podendo ser erro no conjunto de dados ou existe a possibilidade do mutuário simplesmente não programar um valor para o pagamento mensal, obtendo assim o valor zero.<br/>
Nesse caso foi considerado a segunda possibilidade e os dados foram mantidos.
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Verificando os dados com parcela de 0
#names(dff)
subset(dff, MonthlyLoanPayment == 0) %>% 
  select(MemberKey, Term, LoanOriginalAmount, MonthlyLoanPayment, BorrowerAPR, ProsperScore) %>%
  summary()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Convertendo a variável cronológica em data
dff$LoanOriginationDate <- as.Date(dff$LoanOriginationDate)
# Convertendo a variável cronológica em data
ggplot(dff, aes(x = LoanOriginationDate)) + 
  geom_histogram(binwidth = 30, color='black') +
  scale_x_date(breaks = '1 year', date_labels = '%Y')
```
<br/>Ocorreu um aumento considerável de empréstimo a partir de 2013 e por alguma razão não há nenhum registro no começo de 2009 e final de 2008.

# Análise Univariada

### Qual é a estrutura do conjunto de dados?
São 113.937 empréstimos com 81 variáveis em cada um.<br/>
Visando uma exploração mais sucinta, foram escolhidas 15 variáveis de interesse, sendo elas:

* Duas variáveis identificadoras (MemberKey e LoanKey);
* Sete variáveis numéricas (BorrowerAPR, BorrowerRate, ProsperScore, EmploymentStatusDuration, StatedMonthlyIncome, LoanOriginalAmount e MonthlyLoanPayment);
* Uma variável cronológica (LoanOriginationDate);
* E cinco variáveis categóricas (Term, LoanStatus, ListingCategory..numeric., Occupation e EmploymentStatus)

A variável <em>ListingCategory..numeric.</em> está representada numéricamente, com a seguinte relação:

0. Não disponível
1. Consolidação da dívida
2. Melhoria da casa
3. Negócios
4. Empréstimo pessoal
5. Uso do aluno
6. Automático
7. Outros 
8. Bebê e Adoção
9. Barco
10. Procedimento Cosmético
11. Anel de Noivado
12. Empréstimos Verdes
13. Gastos Domésticos
14. Grandes Compras
15. Médico / Odontológico
16. Motocicleta
17. VD
18. Impostos
19. Férias
20. Empréstimos do casamento

Outras observações:

* A maioria dos empréstimos solicitados são menos de 12000.
* Menos de 0.5% dos mutuários têm renda mensal acima de 25000, o mais comum é ganharem de 3200 a 6800.
* Normalmente os valores solicitados são múltiplos de 5000, com exceção aos empréstimos de 4000 que são os mais numerosos.
* Existem mutuários empregados por mais de 62 anos e os que não estão empregados. Em média estão 8 anos empregados.
* Apenas 0.7% dos mutuários são declaradamente desempregados.
* A duração do empréstimo mais solicitada é de 36 meses, em seguida de 60 meses e muito raramente 12 meses.

### Quais são os principais atributos de interesse deste conjunto de dados?
Os principais atributos de interesse são o montante original do empréstimo, renda declarada e razão pela qual solicitou o empréstimo. Quero entender quais são os perfís mais comuns de mutuários e suas motivações para solicitar os respectivos valores. Imagino que há uma correlação positiva de valor solicitado com a renda declarada ou talvez tempo de serviço.

### Quais outros atributos você acha que podem lhe auxiliar na investigação destes atributos de interesse?

### Você criou novas variáveis a partir dos atributos existentes no conjunto de dados?

### Dos atributos investigados, distribuições incomuns foram encontradas? Você aplicou operações nos dados para limpá-los, ajustá-los ou mudar a forma dos dados? Se sim, por quê?



# Seção de Gráficos Bivariados
```{r echo=FALSE, Bivariate_Plots}

```

# Análise Bivariada

### Discuta sobre alguns dos relacionamentos observados nesta parte da investigação. Como os atributos de interesse variaram no conjunto de dados?

### Você observou algum relacionamento interessante entre os outros atributos (os que não são de interesse)?

### Qual foi o relacionamento mais forte encontrado?




# Seção de Gráficos Multivariados

```{r echo=FALSE, Multivariate_Plots}

```

# Análise Multivariada

### Discuta sobre os relacionamentos observados nesta parte da investigação. Quais atributos que fortaleceram os demais na observação das variáveis de interesse?

### Interações surpreendentes e/ou interessantes foram encontradas entre os atributos?

### OPCIONAL: Modelos foram criados usando este conjunto de dados? Discuta sobre os pontos fortes e as limitações do seu modelo.

------

# Gráficos Finais e Sumário

### Primeiro Gráfico
```{r echo=FALSE, Plot_One}

```

### Descrição do Primeiro Gráfico


### Segundo Gráfico
```{r echo=FALSE, Plot_Two}

```

### Descrição do Segundo Gráfico


### Terceiro Gráfico
```{r echo=FALSE, Plot_Three}

```

### Descrição do Terceiro Gráfico

------

# Reflexão


